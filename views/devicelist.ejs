<%- include('header.ejs', {title: 'DeviceList', userImg: '/image/iot_2.png',
currentPage:'devicelist'}) %>

<div class="col-12">
  <div class="bg-light rounded h-100 p-4">
    <div class="my-4">
      <h3>List of devices that are connected to various sensors.</h3>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Device Name</th>
              <th>Device ID</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% user.devices.forEach(function(device) { %>
            <tr>
              <td><%= device.deviceName %></td>
              <td><%= device.deviceId %></td>
              <!-- <td><a href="/<%= device.deviceId %>/activity" class="btn btn-primary">View Activity</a></td>
                            <td>
                              <a href="/editDevice/<%= device._id %>" class="btn btn-primary">Edit Device</a>
                            </td> -->
              <td>
                <% const recentStatus = deviceStatuses.find(status =>
                status.deviceId === device.deviceId); %> <% if (recentStatus &&
                recentStatus.status === "on") { %>
                <!-- <span style="color: green">&#x25CF;</span>  -->
                <span
                  style="
                    width: 15px;
                    height: 15px;
                    border-radius: 10px;
                    display: block;
                    background: green;
                  "
                ></span>
                <!-- Green dot for on status -->
                <% } else { %>
                <span
                  style="
                    width: 15px;
                    height: 15px;
                    border-radius: 10px;
                    display: block;
                    background: red;
                  "
                ></span>
                <!-- Red dot for off status -->
                <% } %>
              </td>
              <td>
                <!-- View Activity Button -->
                <a
                  href="/<%= device.deviceId %>/activity"
                  class="btn btn-primary"
                  ><i class="fas fa-eye"></i
                ></a>
                <!-- Edit Device Button -->
                <a href="/editDevice/<%= device._id %>" class="btn btn-primary"
                  ><i class="fas fa-edit"></i
                ></a>

                <!-- Delete Device Form -->
                <form
                  action="/deleteDevice/<%= device._id %>"
                  method="post"
                  style="display: inline"
                  onsubmit="return confirm('Are you sure you want to delete this device?')"
                >
                  <button type="submit" class="btn btn-outline-danger">
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<%- include('footer.ejs') %>
